language: cpp
os:
- linux
- osx
addons:
  apt:
    sources:
    - ubuntu-toolchain-r-test
    packages:
    - g++-4.8
    - g++-4.8-multilib
    - gcc-multilib
    - build-essential
    - libbluetooth-dev
    - libudev-dev
    - libusb-1.0-0-dev
env:
  matrix:
  - PACKAGER_NODE_VERSION="5.5" PACKAGER_ARCH="amd64" MAIN_BUILD="true"
  - PACKAGER_NODE_VERSION="5.5" PACKAGER_ARCH="386"
matrix:
  exclude:
  - os: osx
    env: PACKAGER_NODE_VERSION="5.5" PACKAGER_ARCH="386"
branches:
  only:
  - "/^v[0-9]/"
before_install:
- PACKAGER_URL="https://meshblu-connector.octoblu.com/tools/packager/latest"
- curl -fsS "${PACKAGER_URL}/travis_install_node.sh" -o /tmp/travis_install_node.sh
- chmod +x /tmp/travis_install_node.sh
- ". /tmp/travis_install_node.sh"
- if [ "$TRAVIS_OS_NAME" == "linux" -a "$MAIN_BUILD" == "true" ]; then export NPM_PUBLISH="true"; fi
install:
- npm install --build-from-source
script:
- npm test
before_deploy:
- npm run package
deploy:
- provider: releases
  api_key:
    secure: "Rh52be/L5erekjINbwn+YGkqiPjOhvq3/X3ehfSjCCXKsSXS7ueFvyF2fNI1B/J3y92agh2+f3Dblm12sXyzaa62EN0zx5fN/4NLJwxEUPa0hsgMCeecG7ArCF48WfEDwpoQWzgIB2D3Fj3L4mhbt8Xb89GSQQ5rmNXN9ZZSHooRxOL18HJeNQ0IpyafykbHWMlVbEu2T0OqmoLv2TMHGS41nwqDzrHuoPxBWPb9j2UiFoL016siYlLI29F9V2kIzDnC5Pk0zHXDSqGqAOlYDUvju/2IwjNhMldcpSy0KkuL9V4+sTH5v5NiUdJC6yZDFNsIy33UbFChPihGLiyNDSEr79y2bRj/AQlaZ4fJAPaoQcyCnlMdjLY3AISIiBWyucPviAnM/CAgA9lyTCktmofLAfNvEtJflQijY76z79LHxPzMDhrsbaPVWOXIKBHtHfBaQnw3jhEFUknkyzA/U6Ah/lmm/qEhCaqqV7VuihYZ7WRG+1hqk/jPvOnajqW114FjQjS0RVhPwAXkUKBPu0lOi++pklK1cT3lAW7uO1dhk8Vb2kbL4k1VRhNo018kZJwo59IjLNmvmffsDhHYu0ZHnjCK6k39OwD72OehfuSY44FB84NtKHdFF8KUNNQrXrPs2yz7xbvTNmkHtkE59tN5a8vJtDvNMitQuxgHorg="
  file_glob: true
  file:
  - "deploy/*"
  skip_cleanup: true
  on:
    tags: true
- provider: npm
  email: serveradmin@octoblu.com
  api_key:
    secure: "o47cKia3wXNmFTu+mJ83Z5lXQwzAnEdvFDZgmRwfWjZJrHD3ABjYsDk4klWrsdUJ1dFvcwINnlWdWsCQegm1CPzb0swPJJDEsg1Ri/N9D8jIgn7k3Ys1jFR+wfuJDKypD7/E/d9k4h7o//pBvRo7yONOwe/HfN/WKvmSJlMVUiW1yjOX98TdZYRBLcV5gB88jBOq3TXnX86gaL+Jm66sXN6tJPjc5qf08sMn7TigUCl3wzWnDmzFPdvVki1K9P7UEaOt49bVWTCF09Xt9jyLLoiCRL+ffH+qbELD/Ji5QLMXxwxZuNdwzDpq/BV4IHqQzti9fqU4bTQQTTDLfjl+AS69jhZp/noOXH0pdfGcYpQcBr7pPARapiOPX9CP3mve20Ft0ZLWrGnCWde02EsU1rqIsZWbp6C8U9hd7KPHm5qc3DeK1CIgTSJT+aZ9L7WFKqQRXmRJzK16b48rcsp70C6FggZJxsUTzm3glBAWUy2IE+j2mczRIncHmnt/coCBr9eMHHl2q5sLnu6WqQeY5/HKtVbih1G+3zPPcKpmancJycrWbo/GB7F2QiZtzTTha361pzNy8aS4KO5JDEzI3cZP4OUJ5ESMBOgIN3QfQ4+/3d7peiPA45aUlEKM6r4Gq2yutgmY1V6Oqs4EBLQj9l7BwS8/pvfk6igX94F2hSk="
  on:
    tags: true
    condition: "$NPM_PUBLISH = true"
